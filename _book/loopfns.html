<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Loop Functions | Programming for Data Science in R</title>
<meta name="author" content="Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><script src="libs/d3-3.5.6/d3.min.js"></script><link href="libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet">
<script src="libs/profvis-0.3.6.9000/profvis.js"></script><script src="libs/profvis-0.3.6.9000/scroll.js"></script><link href="libs/highlight-6.2.0/textmate.css" rel="stylesheet">
<script src="libs/highlight-6.2.0/highlight.js"></script><script src="libs/profvis-binding-0.3.7/profvis.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163213745-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-163213745-1');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="bootstrap.lambdamd.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Programming for Data Science in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">PDSR</a></li>
<li><a class="" href="preface.html"><span class="header-section-number">1</span> Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="Rsetup.html"><span class="header-section-number">3</span> R setup, Packages &amp; Docs</a></li>
<li><a class="" href="basicops.html"><span class="header-section-number">4</span> Basic operations</a></li>
<li><a class="" href="types.html"><span class="header-section-number">5</span> Data Types</a></li>
<li><a class="" href="structures.html"><span class="header-section-number">6</span> Data Structures</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">7</span> Factors</a></li>
<li><a class="" href="indexing.html"><span class="header-section-number">8</span> Indexing - Subsetting - Slicing</a></li>
<li><a class="" href="vectorization.html"><span class="header-section-number">9</span> Vectorized Operations</a></li>
<li><a class="" href="dataio.html"><span class="header-section-number">10</span> Data Input/Output</a></li>
<li><a class="" href="controlflow.html"><span class="header-section-number">11</span> Control flow</a></li>
<li><a class="active" href="loopfns.html"><span class="header-section-number">12</span> Loop Functions</a></li>
<li><a class="" href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">14</span> Functions</a></li>
<li><a class="" href="dataframes.html"><span class="header-section-number">15</span> Working with data frames</a></li>
<li><a class="" href="datatrans.html"><span class="header-section-number">16</span> Data Transformations</a></li>
<li><a class="" href="stringops.html"><span class="header-section-number">17</span> String Operations</a></li>
<li><a class="" href="datetime.html"><span class="header-section-number">18</span> Date and Time</a></li>
<li><a class="" href="missingdata.html"><span class="header-section-number">19</span> Handling Missing data</a></li>
<li><a class="" href="classes.html"><span class="header-section-number">20</span> Classes and Object-Oriented Programming</a></li>
<li><a class="" href="datatable.html"><span class="header-section-number">21</span> Efficient data analysis with data.table</a></li>
<li><a class="" href="basegraphics.html"><span class="header-section-number">22</span> Base Graphics</a></li>
<li><a class="" href="graphics3x.html"><span class="header-section-number">23</span> 3x Graphics</a></li>
<li><a class="" href="colors.html"><span class="header-section-number">24</span> Colors in R</a></li>
<li><a class="" href="profiling.html"><span class="header-section-number">25</span> Timing &amp; Profiling</a></li>
<li><a class="" href="optim.html"><span class="header-section-number">26</span> Optimization with optim()</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">27</span> Introduction to the GLM</a></li>
<li><a class="" href="resampling.html"><span class="header-section-number">28</span> Resampling</a></li>
<li><a class="" href="supervised.html"><span class="header-section-number">29</span> Supervised Learning</a></li>
<li><a class="" href="unsupervised.html"><span class="header-section-number">30</span> Unsupervised Learning</a></li>
<li><a class="" href="git.html"><span class="header-section-number">31</span> Git &amp; GitHub: the basics</a></li>
<li><a class="" href="shell.html"><span class="header-section-number">32</span> Introduction to the system shell</a></li>
<li><a class="" href="resources.html"><span class="header-section-number">33</span> Resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="loopfns" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Loop Functions<a class="anchor" aria-label="anchor" href="#loopfns"><i class="fas fa-link"></i></a>
</h1>
<p>Loop functions are some of the most widely used R functions. They replace longer expressions created with a <code>for</code> loop, for example.<br>
They can result in more compact and readable code and are often faster to execute than a <code>for</code> loop.</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code>: Apply function over array margins (i.e. over one or more dimensions)</li>
<li>
<code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>: Return a <em>list</em> where each element is the result of applying a function to each element of the input</li>
<li>
<code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>: Same as <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, but returns the simplest possible R object (instead of always returning a list)</li>
<li>
<code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code>: Same as <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>, but you pre-specify the return type: this is safer and may also be faster</li>
<li>
<code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code>: Apply a function to elements of groups defined by a factor</li>
<li>
<code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code>: Multivariate version of <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>: Apply a function using the first elements of the inputs vectors, then using the second, third, and so on</li>
</ul>
<div class="figure" style="text-align: center">
<span id="fig:FigRapplyfam"></span>
<img src="R_applyfam.png" alt="`*apply()` function family summary (Best to read through this chapter first and then refer back to this figure)" width="75%"><p class="caption">
Figure 12.1: <code>*apply()</code> function family summary (Best to read through this chapter first and then refer back to this figure)
</p>
</div>
<p>Before starting to use the above functions, we need to learn about anonymous functions, which are often used within the apply functions.</p>
<div id="apply" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> <code>apply()</code><a class="anchor" aria-label="anchor" href="#apply"><i class="fas fa-link"></i></a>
</h2>
<div class="rmdtip">
<p>
<code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> applies a function over one or more dimensions of an array of 2 dimensions or more (this includes matrices) or a data frame:
</p>
<p>
<code><a href="https://rdrr.io/r/base/apply.html">apply(array, MARGIN, FUN)</a></code>
</p>
</div>
<p><code>MARGIN</code> can be an integer vector or character indicating the dimensions over which ‘FUN’ will be applied.</p>
<p>By convention, rows come first (just like in <a href="indexing.html#indexing">indexing</a>), therefore:<br><code>MARGIN = 1</code>: apply function on each <strong><em>row</em></strong>
<code>MARGIN = 2</code>: apply function on each <strong><em>column</em></strong></p>
<p>Let’s calculate the mean value of each of the first four columns of the iris dataset:</p>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>
<span class="va">iris_column_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">x</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span> 
<span class="va">iris_column_mean</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 </code></pre>
<div class="rmdnote">
<p>
Hint: It is possibly easiest to think of the “MARGIN” as the <strong><em>dimension you want to keep</em></strong>.<br>
In the above case, we want the mean for each variable, i.e. we want to keep columns and collapse rows.
</p>
</div>
<p>The above is equivalent to:</p>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_column_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iris_column_mean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">iris_column_mean</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">iris_column_mean</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 </code></pre>
<p>If you wanted to get the mean of the rows (makes little sense in this case):</p>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 2.550 2.375 2.350 2.350 2.550 2.850</code></pre>
<div class="rmdnote">
<p>
<code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> only works on objects with defined (i.e. non-NULL) <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code>, i.e. arrays.
</p>
</div>
<div class="rmdnote">
<p>
Try to think why you can’t use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> to apply a function <code>fn()</code> on a vector <code>v</code>.
</p>
<p>
…
</p>
<p>
…
</p>
<p>
Because that would be <code>fn(v)</code>
</p>
</div>
</div>
<div id="lapply" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> <code>lapply()</code><a class="anchor" aria-label="anchor" href="#lapply"><i class="fas fa-link"></i></a>
</h2>
<div class="rmdtip">
<p>
<code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> applies a <strong>function</strong> on <strong>each element of its input</strong> and returns a <strong>list</strong> of the outputs.
</p>
</div>
<p>Note: The ‘elements’ of a data frame are its columns (remember, a data frame is a list with equal-length elements). The ‘elements’ of a matrix are each cell one by one, by column. Therefore <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> has a very different effect on a data frame and a matrix. <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> is commonly used to iterate over the columns of a data frame.</p>
<p><code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> is the only function of the <code>*apply()</code> family that always returns a list.</p>
<div class="sourceCode" id="cb776"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris.median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">median</span><span class="op">)</span>
<span class="va">iris.median</span></code></pre></div>
<pre><code>$Sepal.Length
[1] 5.8

$Sepal.Width
[1] 3

$Petal.Length
[1] 4.35

$Petal.Width
[1] 1.3</code></pre>
<p>The above is equivalent to:</p>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris.median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iris.median</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">iris.median</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="sapply" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> <code>sapply()</code><a class="anchor" aria-label="anchor" href="#sapply"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> is an alias for <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, followed by a call to <code><a href="https://rdrr.io/r/base/lapply.html">simplify2array()</a></code>.<br>
(Check the source code for <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> by typing <code>sapply</code> at the console and hitting Enter).</p>
<div class="rmdnote">
<p>
Unlike <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, the output of <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> is variable: it is the simplest R object that can hold the data type(s) resulting from the operations, i.e. a vector, matrix, data frame, or list.
</p>
</div>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris.median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">median</span><span class="op">)</span>
<span class="va">iris.median</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
        5.80         3.00         4.35         1.30 </code></pre>
<div class="sourceCode" id="cb781"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris.summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">mean</span><span class="op">)</span>,
                           SD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris.summary</span></code></pre></div>
<pre><code>                 Mean        SD
Sepal.Length 5.843333 0.8280661
Sepal.Width  3.057333 0.4358663
Petal.Length 3.758000 1.7652982
Petal.Width  1.199333 0.7622377</code></pre>
</div>
<div id="vapply" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> <code>vapply()</code><a class="anchor" aria-label="anchor" href="#vapply"><i class="fas fa-link"></i></a>
</h2>
<p>Much less commonly used (possibly <em>underused</em>) than <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> or <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> allows you to specify what the expected output looks like - for example a numeric vector of length 2, a character vector of length 1.</p>
<p>This can have two advantages:</p>
<ul>
<li>It is safer against errors</li>
<li>It will sometimes be a little faster</li>
</ul>
<p>You add the argument <code>FUN.VALUE</code> which must be of the correct <strong>type</strong> and <strong>length</strong> of the expected result <strong><em>of each iteration</em></strong>.</p>
<div class="sourceCode" id="cb783"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">median</span>, FUN.VALUE <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
        5.80         3.00         4.35         1.30 </code></pre>
<p>Here, each iteration returns the median of each column, i.e. a numeric vector of length 1.
Therefore <code>FUN.VALUE</code> can be any numeric scalar.</p>
<p>For example, if we instead returned the range of each column, <code>FUN.VALUE</code> should be a numeric vector of length 1:</p>
<div class="sourceCode" id="cb785"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">range</span>, FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]          4.3         2.0          1.0         0.1
[2,]          7.9         4.4          6.9         2.5</code></pre>
<p>If <code>FUN.VALUE</code> does not match the returned value, we get an informative error:</p>
<div class="sourceCode" id="cb787"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="va">range</span>, FUN.VALUE <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span></code></pre></div>
<pre><code>Error in vapply(iris[, -5], range, FUN.VALUE = 0.1): values must be length 1,
 but FUN(X[[1]]) result is length 2</code></pre>
</div>
<div id="tapply" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> <code>tapply()</code><a class="anchor" aria-label="anchor" href="#tapply"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code> is one way (of many) to apply a function on <strong>subgroups of data</strong> as defined by one or more factors.<br>
In the following example, we calculate the mean Sepal.Length by species on the iris dataset:</p>
<div class="sourceCode" id="cb789"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_Sepal.Length_by_Species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, <span class="va">mean</span><span class="op">)</span>
<span class="va">mean_Sepal.Length_by_Species</span></code></pre></div>
<pre><code>    setosa versicolor  virginica 
     5.006      5.936      6.588 </code></pre>
<p>The above is equivalent to:</p>
<div class="sourceCode" id="cb791"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="va">mean_Sepal.Length_by_Species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mean_Sepal.Length_by_Species</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">species</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mean_Sepal.Length_by_Species</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">[</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="va">species</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">mean_Sepal.Length_by_Species</span></code></pre></div>
<pre><code>    setosa versicolor  virginica 
     5.006      5.936      6.588 </code></pre>
</div>
<div id="mapply" class="section level2" number="12.6">
<h2>
<span class="header-section-number">12.6</span> <code>mapply()</code><a class="anchor" aria-label="anchor" href="#mapply"><i class="fas fa-link"></i></a>
</h2>
<p>The above functions all work well when you iterating over elements of a single object.<br><code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code> allows you to execute a function that accepts two or more inputs, say <code>fn(x, z)</code> using the i-th element of each input, and will return:<br><code>fn(x[1], z[1])</code>, <code>fn(x[2], z[2])</code>, …, <code>fn(x[n], z[n])</code></p>
<p>Let’s create a simple function that accepts two numeric arguments, and two vectors length 5 each:</p>
<div class="sourceCode" id="cb793"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">power</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="va">power</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">6</span><span class="op">:</span><span class="fl">2</span></code></pre></div>
<p>Use mapply to raise each <code>x</code> to the corresponding <code>p</code>:</p>
<div class="sourceCode" id="cb794"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span><span class="va">raise</span>, <span class="va">x</span>, <span class="va">p</span><span class="op">)</span>
<span class="va">out</span></code></pre></div>
<pre><code>[1]  64 243 256 125  36</code></pre>
<p>The above is equivalent to:</p>
<div class="sourceCode" id="cb796"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, <span class="fl">5</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">raise</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">out</span></code></pre></div>
<pre><code>[1]  64 243 256 125  36</code></pre>
</div>
<div id="iterating-over-a-sequence-instead-of-an-object" class="section level2" number="12.7">
<h2>
<span class="header-section-number">12.7</span> Iterating over a sequence instead of an object<a class="anchor" aria-label="anchor" href="#iterating-over-a-sequence-instead-of-an-object"><i class="fas fa-link"></i></a>
</h2>
<p>With <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> and <code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code> there is a very simple trick that may often come in handy:<br>
Instead of iterating over elements of an object, you can iterate over an integer index of whichever elements you want to access and use it accordingly within the anonymous function.<br>
This alternative approach is much closer to how we would use an integer sequence in a <code>for</code> loop.<br>
It will be clearer through an example:</p>
<p>Get the mean of the first four columns of iris:</p>
<div class="sourceCode" id="cb798"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># original way: iterate through elements i.e. columns:</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 </code></pre>
<div class="sourceCode" id="cb800"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative way: iterate over integer index of elements:</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 5.843333 3.057333 3.758000 1.199333</code></pre>
<div class="sourceCode" id="cb802"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># equivalent to:</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Notice that in the alternative approach, since you are not passing the object (iris, here) as the input to <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, therefore it needs to be specified within the anonymous function.</p>
</div>
<div id="applying-on-matrices-vs.-data-frames" class="section level2" number="12.8">
<h2>
<span class="header-section-number">12.8</span> <code>*apply()</code>ing on matrices vs. data frames<a class="anchor" aria-label="anchor" href="#applying-on-matrices-vs.-data-frames"><i class="fas fa-link"></i></a>
</h2>
<p>To consolidate some of what was learned above, let’s focus on the difference between working on a matrix vs. a data frame.<br>
First, let’s create a matrix and a data frame with the same data:</p>
<div class="sourceCode" id="cb803"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">21</span><span class="op">:</span><span class="fl">70</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">amat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Feature_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">amat</span><span class="op">)</span><span class="op">)</span>
<span class="va">amat</span></code></pre></div>
<pre><code>      Feature_1 Feature_2 Feature_3 Feature_4 Feature_5
 [1,]        21        31        41        51        61
 [2,]        22        32        42        52        62
 [3,]        23        33        43        53        63
 [4,]        24        34        44        54        64
 [5,]        25        35        45        55        65
 [6,]        26        36        46        56        66
 [7,]        27        37        47        57        67
 [8,]        28        38        48        58        68
 [9,]        29        39        49        59        69
[10,]        30        40        50        60        70</code></pre>
<div class="sourceCode" id="cb805"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">amat</span><span class="op">)</span>
<span class="va">adf</span></code></pre></div>
<pre><code>   Feature_1 Feature_2 Feature_3 Feature_4 Feature_5
1         21        31        41        51        61
2         22        32        42        52        62
3         23        33        43        53        63
4         24        34        44        54        64
5         25        35        45        55        65
6         26        36        46        56        66
7         27        37        47        57        67
8         28        38        48        58        68
9         29        39        49        59        69
10        30        40        50        60        70</code></pre>
<p>We’ve seen that with <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> we specify the dimension to operate on and it works the same way on both matrices and data frames:</p>
<div class="sourceCode" id="cb807"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">amat</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></code></pre></div>
<pre><code>Feature_1 Feature_2 Feature_3 Feature_4 Feature_5 
     25.5      35.5      45.5      55.5      65.5 </code></pre>
<div class="sourceCode" id="cb809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">adf</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></code></pre></div>
<pre><code>Feature_1 Feature_2 Feature_3 Feature_4 Feature_5 
     25.5      35.5      45.5      55.5      65.5 </code></pre>
<p>However, <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> (and <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, <code><a href="https://rdrr.io/r/base/lapply.html">vapply()</a></code>) acts on <strong><em>each element</em></strong> of the object, therefore it is not meaningful to pass a matrix to it:</p>
<div class="sourceCode" id="cb811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">amat</span>, <span class="va">mean</span><span class="op">)</span></code></pre></div>
<pre><code> [1] 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45
[26] 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70</code></pre>
<p>The above returns the mean of each element, i.e. the element itself, which is pointless.</p>
<p>Since a data frame is a list, and its columns are its elements, it works great for column operations on data frames:</p>
<div class="sourceCode" id="cb813"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">adf</span>, <span class="va">mean</span><span class="op">)</span></code></pre></div>
<pre><code>Feature_1 Feature_2 Feature_3 Feature_4 Feature_5 
     25.5      35.5      45.5      55.5      65.5 </code></pre>
<p>If you want to use <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> on a matrix, you could iterate over an integer sequence as shown in the previous section:</p>
<div class="sourceCode" id="cb815"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">amat</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">amat</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 25.5 35.5 45.5 55.5 65.5</code></pre>
<p>This is shown to help emphasize the differences between the function and the data structures. In practice, you would use <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> on a matrix.</p>
</div>
<div id="anonymous-functions" class="section level2" number="12.9">
<h2>
<span class="header-section-number">12.9</span> Anonymous functions<a class="anchor" aria-label="anchor" href="#anonymous-functions"><i class="fas fa-link"></i></a>
</h2>
<p>Anonymous functions are just like regular functions but they are not assigned to an object - i.e. they are not “named.”<br>
They are usually passed as arguments to other functions to be used once, hence no need to name them.<br>
In R, anonymous functions are often used with the apply family of functions.</p>
<p>Example of a simple regular function:</p>
<div class="sourceCode" id="cb817"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">squared</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span></code></pre></div>
<p>Because this is a short function definition, it can also be written in a single line without curly brackets:</p>
<div class="sourceCode" id="cb818"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">squared</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span></code></pre></div>
<p>The equivalent anonymous function is the same, but omitting the assignment:</p>
<div class="sourceCode" id="cb819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span></code></pre></div>
<pre><code>function(x) x^2</code></pre>
<p>Let’s use the <code>squared()</code> function within <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code> to square the first four columns of the iris dataset. In these examples, we often wrap functions around <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> which prints the first few lines of an object to avoid:</p>
<div class="sourceCode" id="cb821"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width
1          5.1         3.5          1.4         0.2
2          4.9         3.0          1.4         0.2
3          4.7         3.2          1.3         0.2
4          4.6         3.1          1.5         0.2
5          5.0         3.6          1.4         0.2
6          5.4         3.9          1.7         0.4</code></pre>
<div class="sourceCode" id="cb823"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">squared</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris_sq</span><span class="op">)</span></code></pre></div>
<pre><code>     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]        26.01       12.25         1.96        0.04
[2,]        24.01        9.00         1.96        0.04
[3,]        22.09       10.24         1.69        0.04
[4,]        21.16        9.61         2.25        0.04
[5,]        25.00       12.96         1.96        0.04
[6,]        29.16       15.21         2.89        0.16</code></pre>
<p>Let’s do the same as above, but this time using an anonymous function:</p>
<div class="sourceCode" id="cb825"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_sqtoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris_sqtoo</span><span class="op">)</span></code></pre></div>
<pre><code>     Sepal.Length Sepal.Width Petal.Length Petal.Width
[1,]        26.01       12.25         1.96        0.04
[2,]        24.01        9.00         1.96        0.04
[3,]        22.09       10.24         1.69        0.04
[4,]        21.16        9.61         2.25        0.04
[5,]        25.00       12.96         1.96        0.04
[6,]        29.16       15.21         2.89        0.16</code></pre>
<p>The entire anonymous function definition is passed in the function argument (<code>FUN</code> in the R documentation).</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="controlflow.html"><span class="header-section-number">11</span> Control flow</a></div>
<div class="next"><a href="summarize.html"><span class="header-section-number">13</span> Summarizing Data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#loopfns"><span class="header-section-number">12</span> Loop Functions</a></li>
<li><a class="nav-link" href="#apply"><span class="header-section-number">12.1</span> apply()</a></li>
<li><a class="nav-link" href="#lapply"><span class="header-section-number">12.2</span> lapply()</a></li>
<li><a class="nav-link" href="#sapply"><span class="header-section-number">12.3</span> sapply()</a></li>
<li><a class="nav-link" href="#vapply"><span class="header-section-number">12.4</span> vapply()</a></li>
<li><a class="nav-link" href="#tapply"><span class="header-section-number">12.5</span> tapply()</a></li>
<li><a class="nav-link" href="#mapply"><span class="header-section-number">12.6</span> mapply()</a></li>
<li><a class="nav-link" href="#iterating-over-a-sequence-instead-of-an-object"><span class="header-section-number">12.7</span> Iterating over a sequence instead of an object</a></li>
<li><a class="nav-link" href="#applying-on-matrices-vs.-data-frames"><span class="header-section-number">12.8</span> *apply()ing on matrices vs. data frames</a></li>
<li><a class="nav-link" href="#anonymous-functions"><span class="header-section-number">12.9</span> Anonymous functions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Data Science in R</strong>" was written by Efstathios (Stathis) D. Gennatas, MBBS AICSM PhD. It was last built on 2021-07-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
